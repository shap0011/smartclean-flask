{% extends "base.html" %} {% block title %}Clean Page{% endblock %} {% block
header1 %}Clean{% endblock %} {% block content %}

<!-- ===================== -->
<!-- 1) Upload CSV -->
<!-- ===================== -->
<form action="/clean" method="post" enctype="multipart/form-data">
  <div class="mb-3">
    <label for="inputFile" class="form-label">Upload your dataset:</label>
    <input
      type="file"
      name="file"
      required
      class="form-control"
      id="inputFile"
      accept=".csv"
    />
  </div>
  <button type="submit" class="btn btn-primary">Upload New Dataset</button>
</form>

{% if alert %}
<hr />
<div class="alert alert-success" role="alert">{{ alert }}</div>
{% endif %}

<!-- Show the rest only if a dataset exists -->
{% if session.get("dataset_id") %}

<!-- ===================== -->
<!-- 2) Upload Results -->
<!-- ===================== -->
{% if df_info %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Dataset Info</h3>
    <pre>
{% for line in df_info %}{{ line }}
{% endfor %}</pre
    >
  </div>
</div>
{% endif %} {% if df_duplicates %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Duplicate Rows</h3>
    <pre>{{ df_duplicates }}</pre>
  </div>
</div>
{% endif %} {% if df_duplicates_deleted %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Deleting Dataset Duplicates</h3>
    <pre>{{ df_duplicates_deleted }}</pre>
  </div>
</div>
{% endif %} {% if df_head %}
<div class="card mt-3">
  <div class="card-body">
    <h3>First Five Rows of Dataset</h3>
    <div class="table-responsive">{{ df_head | safe }}</div>
  </div>
</div>
{% endif %} {% if df_describe %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Summary Statistics</h3>
    <div class="table-responsive">{{ df_describe | safe }}</div>
  </div>
</div>
{% endif %} {% if df_missings %}
<div class="card">
  <div class="card-body">
    <h3>Missing Values</h3>

    {% if df_missings is string %}
    <p>{{ df_missings }}</p>
    {% else %}
    <pre>
      {% for col, count in df_missings.items() %}
        {{ col }}: {{ count }}
      {% endfor %}
      </pre
    >
    {% endif %}
  </div>
</div>
{% endif %}

<hr class="my-4" />

<!-- ===================== -->
<!-- 3) Numeric Cleaning -->
<!-- ===================== -->
<form method="post" action="/clean_numeric_columns">
  <h4 id="numeric-clean">Numeric columns cleaning</h4>

  {% if numeric_cols_list and numeric_cols_list|length > 0 %}
  <p class="text-muted">
    Available numeric-like columns:
    <strong>{{ numeric_cols_list | join(', ') }}</strong>
  </p>

  <input
    type="text"
    class="form-control"
    name="numeric_cols"
    placeholder="e.g. {{ numeric_cols_list[:3] | join(', ') }}"
    required
  />

  <p class="text-muted mt-2">
    You can submit this form multiple times to clean different numeric columns
    step by step.
  </p>

  <button type="submit" class="btn btn-primary mt-3">Submit</button>
  {% else %}
  <p class="text-muted">No numeric columns detected in this dataset.</p>
  {% endif %}
</form>

{% if df_describe_4 %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Summary Statistics (after numeric conversion)</h3>
    <div class="table-responsive">{{ df_describe_4 | safe }}</div>
  </div>
</div>
{% endif %} {% if missings_percentage %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Percentage of Missing Values</h3>
    <pre>
{% for column, percentage in missings_percentage.items() %}{{ column }}: {{ percentage | round(2) }}%
{% endfor %}</pre
    >
  </div>
</div>
{% endif %} {% if columns_less_5_perc_missing %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Columns with less than 5% missing values</h3>
    <pre>
{% for c in columns_less_5_perc_missing %}{{ c }}
{% endfor %}</pre
    >
    <p class="text-info mt-2">
      Records with missing values in those columns were dropped.
    </p>
  </div>
</div>
{% endif %} {% if missings_percentage_after %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Missing Values After Dropping</h3>
    <pre>
{% for column, percentage in missings_percentage_after.items() %}{{ column }}: {{ percentage | round(2) }}%
{% endfor %}</pre
    >
  </div>
</div>
{% endif %} {% if fill_cat_mis_val %}
<div class="card mt-3">
  <div class="card-body">
    <p class="text-info">
      Remaining missing values were filled with the most frequent value (mode).
    </p>
  </div>
</div>
{% endif %} {% if df_describe_2 %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Summary Statistics (after missing values handling)</h3>
    <div class="table-responsive">{{ df_describe_2 | safe }}</div>
  </div>
</div>
{% endif %}

<hr class="my-4" />

<!-- ===================== -->
<!-- 4) Date Cleaning -->
<!-- ===================== -->
<form action="/clean_date_column" method="post">
  <h4 id="date-clean">Date column cleaning</h4>

  {% if date_cols_list and date_cols_list|length > 0 %}
  <p class="text-muted">
    Detected date-like columns:
    <strong>{{ date_cols_list | join(', ') }}</strong>
  </p>

  <input
    type="text"
    name="date_col"
    class="form-control"
    id="date_col"
    placeholder="e.g. {{ date_cols_list[0] }}"
    required
  />

  <button type="submit" class="btn btn-primary mt-3">Submit</button>
  {% else %}
  <p class="text-muted">No date columns detected in this dataset.</p>
  {% endif %}
</form>

{% if replace_date_nan %}
<div class="card mt-3">
  <div class="card-body">
    <p class="text-info">
      Missing/invalid values in <strong>{{ date_col }}</strong> were replaced
      with default date <code>2000-01-01</code>.
    </p>
  </div>
</div>
{% endif %} {% if df_describe_5 %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Summary Statistics (after categorical encoding)</h3>
    <div class="table-responsive">{{ df_describe_5 | safe }}</div>
  </div>
</div>
{% endif %} {% if df_info_2 %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Dataset Info (final)</h3>
    <pre>
{% for line in df_info_2 %}{{ line }}
{% endfor %}</pre
    >
  </div>
</div>
{% endif %} {% if df_head_5 %}
<div class="card mt-3">
  <div class="card-body">
    <h3>First Five Rows (final)</h3>
    <div class="table-responsive">{{ df_head_5 | safe }}</div>
  </div>
</div>
{% endif %} {% if df_tail_5 %}
<div class="card mt-3">
  <div class="card-body">
    <h3>Last Five Rows (final)</h3>
    <div class="table-responsive">{{ df_tail_5 | safe }}</div>
  </div>
</div>
{% endif %}

<hr class="my-4" />

<!-- ===================== -->
<!-- 5) Download (always visible when dataset exists) -->
<!-- ===================== -->
<h3 id="download" class="text-center mt-4">Download the cleaned dataset</h3>
<div class="text-center mt-3">
  <a href="{{ url_for('download_cleaned_data') }}" class="btn btn-success">
    Download
  </a>
</div>

{% endif %} {% endblock %}
